var Carousel=Class.create({initialize:function(a,b){this.initOptions(b),this.containerId=a,this.navigationId=this.containerId+"Nav",this.divId=this.containerId+"Div",this.elements=$(this.containerId).select("img"),$(this.containerId).hide(),this.container=$(this.options.containerToRenderId),this.maxIndex=this.elements.size()-1,this.index=0,this.walk()},initOptions:function(a){this.options={containerToRenderId:"carouselAnim",menuClassName:"boxCarouselNav",activeClassName:"selected",boxClassName:"boxCarousel",contentClassName:"boxCarouselContent",buttonClassName:"boxCarouselButton",buttonPauseClassName:"boxCarouselButtonPause",buttonPlayClassName:"boxCarouselButtonPlay",buttonPauseText:"pause",buttonPlayText:"play",buttonNextArrowClassName:"boxCarouselArrowNext",buttonPreviousArrowClassName:"boxCarouselArrowPrevious",bgPosition:"left center",behaviour:"change",behaviourDuration:10,drawSkitHeader:!0,drawSkitSubHeader:!0,drawSkitText:!0,drawSkitButton:!0,drawPausePlayButton:!0,drawNav:!0,drawNavArrows:!0,navigationTextAttr:"alt",skitHeaderAttr:"title",skitSubHeaderAttr:"alt",skitButtonTextAttr:"alt"},Object.extend(this.options,a||{})},renderAll:function(){this.fillContent(this.index),this.renderBg(this.index),this.updateNavigation(this.index),this.index>=this.maxIndex?this.index=0:this.index++},renderBackAll:function(){this.fillContent(this.index),this.renderBg(this.index),this.updateNavigation(this.index),this.index<=0?this.index=this.maxIndex:this.index--},walk:function(){this.buildContent(),this.buildNavigation(),this.renderAll(),this.start(),this.observeNavigation()},start:function(){this.pe=new PeriodicalExecuter(this.renderAll.bind(this),this.options.behaviourDuration)},stop:function(){this.pe.stop(),this.pauseButton.hide(),this.playButton.show()},restart:function(){this.pe.registerCallback(),this.pauseButton.show(),this.playButton.hide()},renderBg:function(a){switch(this.index=a,this.container.setStyle({backgroundImage:"url("+this.elements[a].readAttribute("src")+")",backgroundPosition:this.options.bgPosition}),this.options.behaviour){case"fade":this.container.fade({duration:1,from:.5,to:1});break;case"change":}},buildContent:function(){this.carouselBox=new Element("div",{"class":this.options.boxClassName}),this.carouselContent=new Element("div",{"class":this.options.contentClassName}),this.carouselBox.insert({top:this.carouselContent}),this.container.insert({top:this.carouselBox}),this.skitHeader=new Element("h1"),this.skitSubHeader=new Element("h2"),this.skitText=new Element("p"),this.skitButton=new Element("a",{"class":this.options.buttonClassName}),this.pauseButton=new Element("button",{"class":this.options.buttonPauseClassName}).insert(this.options.buttonPauseText),this.playButton=new Element("button",{"class":this.options.buttonPlayClassName}).insert(this.options.buttonPlayText),this.playButton.hide(),this.options.drawSkitHeader&&this.carouselContent.insert(this.skitHeader),this.options.drawSkitSubHeader&&this.carouselContent.insert(this.skitSubHeader),this.options.drawSkitText&&this.carouselContent.insert(this.skitText),this.options.drawSkitButton&&this.carouselContent.insert(this.skitButton),this.options.drawPausePlayButton&&this.carouselBox.insert(this.pauseButton),this.options.drawPausePlayButton&&this.carouselBox.insert(this.playButton),this.fillContent(this.index)},fillContent:function(a){this.index=a,this.options.drawSkitHeader&&this.skitHeader.update(Object.isElement(this.elements[a].up("a"))?this.elements[a].up("a").readAttribute(this.options.skitHeaderAttr):this.elements[a].readAttribute(this.options.skitHeaderAttr)),this.options.drawSkitSubHeader&&this.skitSubHeader.update(this.elements[a].readAttribute(this.options.skitSubHeaderAttr)),this.options.drawSkitText&&(Object.isElement(this.elements[a].up("a").next("figcaption"))&&this.skitText.update(this.elements[a].up("a").next("figcaption").innerHTML),Object.isElement(this.elements[a].next("figcaption"))&&this.skitText.update(this.elements[a].next("figcaption").innerHTML)),this.options.drawSkitButton&&(Object.isElement(this.elements[a].up("a"))&&this.skitButton.writeAttribute("href",this.elements[a].up("a").readAttribute("href")),this.skitButton.update(this.elements[a].readAttribute(this.options.skitButtonTextAttr)))},buildNavigation:function(){this.carouselNav=new Element("ul",{"class":this.options.menuClassName,id:this.navigationId}),this.options.drawNav&&(this.elements.each(function(a){var b=new Element("li"),c=new Element("a");c.update(a.readAttribute(this.options.navigationTextAttr)),b.insert(c),this.carouselNav.insert(b)}.bind(this)),this.options.drawNav&&this.carouselBox.insert({bottom:this.carouselNav})),this.options.drawNavArrows&&(this.arrowNext=new Element("a",{"class":this.options.buttonNextArrowClassName}),this.arrowPrevious=new Element("a",{"class":this.options.buttonPreviousArrowClassName}),this.carouselBox.insert({bottom:this.arrowNext}),this.carouselBox.insert({bottom:this.arrowPrevious}))},observeNavigation:function(){this.options.drawNav&&this.carouselNav.childElements().each(function(a,b){a.down("a").on("click",function(){this.fillContent(b),this.renderBg(b),this.updateNavigation(b)}.bind(this))}.bind(this)),this.options.drawNavArrows&&(this.pauseButton.on("click",function(){this.stop()}.bind(this)),this.playButton.on("click",function(){this.restart()}.bind(this)),this.arrowNext.on("click",function(){this.renderAll()}.bind(this)),this.arrowPrevious.on("click",function(){this.renderBackAll()}.bind(this)))},updateNavigation:function(a){this.options.drawNav&&(this.index=a,$(this.navigationId).childElements().invoke("removeClassName",this.options.activeClassName),$(this.navigationId).childElements()[a].addClassName(this.options.activeClassName))}});